<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–î–æ—Ä–æ–≥–∞ –¥–æ –æ—Ç–µ–ª—è</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1a2e;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Press Start 2P', monospace;
  }
  canvas {
    display: block;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    cursor: pointer;
    max-width: 100vw;
    max-height: 100vh;
  }
</style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// ‚îÄ‚îÄ‚îÄ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const W = 800, H = 450;
const GROUND_Y = 360;
const GRAVITY = 0.7;
const JUMP_FORCE = -15;
const PLAYER_SPEED = 4;
const WORLD_WIDTH = 3400;
const S = 3; // –º–∞—Å—à—Ç–∞–± –ø–∏–∫—Å–µ–ª—å-–∞—Ä—Ç —Å–ø—Ä–∞–π—Ç–æ–≤

// ‚îÄ‚îÄ‚îÄ –¶–≤–µ—Ç–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const C = {
  sky:       '#FFE066',
  skyDeep:   '#FFD700',
  mountain1: '#C8850A',
  mountain2: '#E8A800',
  ground:    '#5C3A1E',
  grass:     '#7A9E3A',
  purple:    '#6B2FA0',
  purpleL:   '#9B4FD0',
  yellow:    '#FFD700',
  yellowD:   '#E8A800',
  white:     '#FFFFFF',
  black:     '#1A0A2E',
  brown:     '#7A4A1E',
  brownD:    '#4A2A0E',
  skin:      '#F5C5A3',
  red:       '#E03030',
  orange:    '#F07020',
  grey:      '#A0A0A0',
  greyD:     '#606060',
  blue:      '#4080D0',
  green:     '#30A030',
};

// ‚îÄ‚îÄ‚îÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state = 'start'; // 'start' | 'play' | 'jump' | 'splash' | 'win'
let camera = 0;
let animTick = 0;
let won = false;
let splashTick = 0;   // —Ç–∞–π–º–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –±—Ä—ã–∑–≥

// ‚îÄ‚îÄ‚îÄ –ò–≥—Ä–æ–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const player = {
  x: 80,
  y: GROUND_Y - 48,
  vy: 0,
  onGround: true,
  frame: 0,
  frameTimer: 0,
};

// ‚îÄ‚îÄ‚îÄ –ú–∏—Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const platforms = [
  { x: 400, y: GROUND_Y - 60, w: 120, h: 20 },
  { x: 700, y: GROUND_Y - 80, w: 100, h: 20 },
  { x: 1100, y: GROUND_Y - 70, w: 130, h: 20 },
  { x: 1500, y: GROUND_Y - 90, w: 110, h: 20 },
  { x: 1900, y: GROUND_Y - 60, w: 140, h: 20 },
  { x: 2300, y: GROUND_Y - 80, w: 120, h: 20 },
];

const obstacles = [
  { x: 550, y: GROUND_Y - 36, w: 24, h: 36 },
  { x: 950, y: GROUND_Y - 36, w: 24, h: 36 },
  { x: 1350, y: GROUND_Y - 36, w: 24, h: 36 },
  { x: 1750, y: GROUND_Y - 36, w: 24, h: 36 },
  { x: 2100, y: GROUND_Y - 36, w: 24, h: 36 },
];

const FLAG_X = 2700;
const HOTEL_X = 2780;
const POOL_X = 2980;   // –±–∞—Å—Å–µ–π–Ω –ø—Ä–∞–≤–µ–µ –æ—Ç–µ–ª—è
const WIN_X = FLAG_X + 60; // —Ç—Ä–∏–≥–≥–µ—Ä ¬´—Ñ–∏–Ω–∏—à¬ª ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä—ã–∂–∫–∞
const SPLASH_X = POOL_X + 40; // —Ü–µ–Ω—Ç—Ä –±–∞—Å—Å–µ–π–Ω–∞ –∫—É–¥–∞ –ø—Ä—ã–≥–∞–µ—Ç –≥–µ—Ä–æ–π

// ‚îÄ‚îÄ‚îÄ –°–±—Ä–æ—Å –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetGame() {
  player.x = 80;
  player.y = GROUND_Y - 48;
  player.vy = 0;
  player.onGround = true;
  player.frame = 0;
  camera = 0;
  won = false;
  splashTick = 0;
  state = 'play';
}

// ‚îÄ‚îÄ‚îÄ –í–≤–æ–¥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    e.preventDefault();
    handleJump();
  }
});

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const scaleX = W / rect.width;
  const scaleY = H / rect.height;
  const cx = (e.clientX - rect.left) * scaleX;
  const cy = (e.clientY - rect.top) * scaleY;

  if (state === 'start') {
    // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
    if (cx > 290 && cx < 510 && cy > 260 && cy < 310) {
      resetGame();
    }
  } else if (state === 'play') {
    handleJump();
  } else if (state === 'win') {
    if (cx > 270 && cx < 530 && cy > 360 && cy < 410) {
      resetGame();
    }
  }
});

function handleJump() {
  if (state === 'start') { resetGame(); return; }
  if (state === 'play' && player.onGround) {
    player.vy = JUMP_FORCE;
    player.onGround = false;
  }
}

// ‚îÄ‚îÄ‚îÄ –§–∏–∑–∏–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateGame() {
  animTick++;

  if (state !== 'play') return;

  // –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  player.x += PLAYER_SPEED;

  // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
  player.vy += GRAVITY;
  player.y += player.vy;

  // –∑–µ–º–ª—è
  if (player.y >= GROUND_Y - 48) {
    player.y = GROUND_Y - 48;
    player.vy = 0;
    player.onGround = true;
  }

  // –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  for (const p of platforms) {
    if (
      player.x + 20 > p.x && player.x < p.x + p.w &&
      player.y + 48 >= p.y && player.y + 48 <= p.y + p.h + 10 &&
      player.vy >= 0
    ) {
      player.y = p.y - 48;
      player.vy = 0;
      player.onGround = true;
    }
  }

  // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ (–Ω–µ —É–±–∏–≤–∞—é—Ç)

  // –∞–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞
  player.frameTimer++;
  if (player.frameTimer > 8) {
    player.frame = (player.frame + 1) % 2;
    player.frameTimer = 0;
  }

  // –∫–∞–º–µ—Ä–∞
  const targetCam = player.x - 150;
  camera += (targetCam - camera) * 0.12;
  camera = Math.max(0, Math.min(WORLD_WIDTH - W, camera));

  // —Ñ–∏–Ω–∏—à: –ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–æ–±–µ–∂–∞–ª –¥–æ —Ñ–ª–∞–≥–∞ ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä—ã–∂–∫–∞ –≤ –±–∞—Å—Å–µ–π–Ω
  if (player.x > WIN_X && state === 'play') {
    state = 'jump';
  }
}

function updateJump() {
  animTick++;
  // –ø–µ—Ä—Å–æ–Ω–∞–∂ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –±–µ–∂–∞—Ç—å –∫ –±–∞—Å—Å–µ–π–Ω—É
  if (player.x < SPLASH_X - 10) {
    player.x += PLAYER_SPEED;
  }

  // –ø—Ä—ã–≥–∞–µ—Ç –∫–æ–≥–¥–∞ –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –∫—Ä–∞—è –±–∞—Å—Å–µ–π–Ω–∞
  if (player.x >= SPLASH_X - 40 && player.onGround) {
    player.vy = JUMP_FORCE * 1.2;
    player.onGround = false;
  }

  // —Ñ–∏–∑–∏–∫–∞ –ø—Ä—ã–∂–∫–∞
  if (!player.onGround) {
    player.vy += GRAVITY;
    player.y += player.vy;
  }

  // –∞–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞
  player.frameTimer++;
  if (player.frameTimer > 8) { player.frame = (player.frame + 1) % 2; player.frameTimer = 0; }

  // –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥–∏—Ç
  const targetCam = player.x - 150;
  camera += (targetCam - camera) * 0.12;
  camera = Math.max(0, Math.min(WORLD_WIDTH - W, camera));

  // —É–ø–∞–ª –≤ –±–∞—Å—Å–µ–π–Ω (–Ω–∏–∂–µ –≤–æ–¥—ã)
  const poolSurfaceY = GROUND_Y - 20;
  if (!player.onGround && player.y > poolSurfaceY && player.x >= SPLASH_X - 60) {
    player.y = poolSurfaceY + 10;
    state = 'splash';
    splashTick = 0;
  }
}

function updateSplash() {
  animTick++;
  splashTick++;
  // –ø–æ—Å–ª–µ ~2 —Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã
  if (splashTick > 90) {
    state = 'win';
  }
}

// ‚îÄ‚îÄ‚îÄ –†–∏—Å–æ–≤–∞–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
function px(x, y, w, h, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x, y, w, h);
}

// –ì–æ—Ä—ã –Ω–∞ —Ñ–æ–Ω–µ
function drawMountains(offsetX) {
  const peaks = [
    { x: 0, h: 160, w: 200 },
    { x: 120, h: 220, w: 180 },
    { x: 270, h: 170, w: 210 },
    { x: 420, h: 240, w: 160 },
    { x: 540, h: 180, w: 200 },
    { x: 700, h: 200, w: 190 },
    { x: 850, h: 150, w: 220 },
  ];

  // –ø–∞—Ä–∞–ª–ª–∞–∫—Å: –≥–æ—Ä—ã –¥–≤–∏–≥–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ
  const ox = (offsetX * 0.3) % 1000;

  for (let rep = -1; rep <= 1; rep++) {
    for (const m of peaks) {
      const mx = m.x - ox + rep * 1000;

      // –¥–∞–ª—å–Ω—è—è –≥–æ—Ä–∞ (—Å–≤–µ—Ç–ª–µ–µ)
      ctx.fillStyle = C.mountain2;
      ctx.beginPath();
      ctx.moveTo(mx, GROUND_Y - 40);
      ctx.lineTo(mx + m.w / 2, GROUND_Y - 40 - m.h * 0.85);
      ctx.lineTo(mx + m.w, GROUND_Y - 40);
      ctx.fill();

      // —Å–Ω–µ–≥
      ctx.fillStyle = '#FFF8DC';
      ctx.beginPath();
      ctx.moveTo(mx + m.w / 2, GROUND_Y - 40 - m.h * 0.85);
      ctx.lineTo(mx + m.w / 2 - m.w * 0.08, GROUND_Y - 40 - m.h * 0.65);
      ctx.lineTo(mx + m.w / 2 + m.w * 0.08, GROUND_Y - 40 - m.h * 0.65);
      ctx.fill();
    }
  }

  // –±–ª–∏–∂–Ω–∏–µ –≥–æ—Ä—ã (—Ç–µ–º–Ω–µ–µ)
  for (let rep = -1; rep <= 1; rep++) {
    const peaks2 = [
      { x: 50, h: 110, w: 160 },
      { x: 200, h: 130, w: 140 },
      { x: 350, h: 100, w: 170 },
      { x: 490, h: 120, w: 150 },
      { x: 640, h: 105, w: 160 },
      { x: 780, h: 115, w: 145 },
    ];
    const ox2 = (offsetX * 0.5) % 900;
    for (const m of peaks2) {
      const mx = m.x - ox2 + rep * 900;
      ctx.fillStyle = C.mountain1;
      ctx.beginPath();
      ctx.moveTo(mx, GROUND_Y - 40);
      ctx.lineTo(mx + m.w / 2, GROUND_Y - 40 - m.h);
      ctx.lineTo(mx + m.w, GROUND_Y - 40);
      ctx.fill();
    }
  }
}

// –ó–µ–º–ª—è
function drawGround(camX) {
  const startX = Math.floor(camX / 32) * 32;
  // –∑–µ–º–ª—è
  px(-5, GROUND_Y, W + 10, H - GROUND_Y + 5, C.ground);
  // —Ç—Ä–∞–≤–∞
  for (let x = startX - camX - 32; x < W + 32; x += 32) {
    px(x, GROUND_Y - 8, 32, 10, C.grass);
    // —Ç—Ä–∞–≤–∏–Ω–∫–∏
    ctx.fillStyle = '#6A8E2A';
    ctx.fillRect(x + 4, GROUND_Y - 14, 2, 8);
    ctx.fillRect(x + 10, GROUND_Y - 12, 2, 6);
    ctx.fillRect(x + 18, GROUND_Y - 15, 2, 9);
    ctx.fillRect(x + 26, GROUND_Y - 11, 2, 5);
  }
}

// –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
function drawPlatform(p, camX) {
  const sx = p.x - camX;
  // —Ç–µ–ª–æ
  px(sx, p.y, p.w, p.h, C.ground);
  // –≤–µ—Ä—Ö (—Ç—Ä–∞–≤–∞)
  px(sx, p.y, p.w, 6, C.grass);
  // —Ç–µ–Ω—å —Å–Ω–∏–∑—É
  px(sx + 2, p.y + p.h, p.w - 4, 4, 'rgba(0,0,0,0.2)');
}

// –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ (–∫–∞–º–µ–Ω—å)
function drawObstacle(o, camX) {
  const sx = o.x - camX;
  // –∫–∞–º–µ–Ω—å
  px(sx + 2, o.y + 8, o.w - 4, o.h - 8, C.greyD);
  px(sx, o.y + 12, o.w, o.h - 12, C.grey);
  px(sx + 4, o.y + 8, o.w - 8, 6, '#C0C0C0');
  // —Ç—Ä–µ—â–∏–Ω–∞
  ctx.strokeStyle = C.greyD;
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(sx + o.w / 2, o.y + 10);
  ctx.lineTo(sx + o.w / 2 - 4, o.y + 24);
  ctx.lineTo(sx + o.w / 2 + 2, o.y + 32);
  ctx.stroke();
}

// –§–ª–∞–≥
function drawFlag(camX) {
  const sx = FLAG_X - camX;
  if (sx < -20 || sx > W + 20) return;

  // —Ñ–ª–∞–≥—à—Ç–æ–∫
  px(sx + 4, GROUND_Y - 120, 4, 120, C.brownD);

  // —Ñ–ª–∞–≥ (–∞–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—ë—Ç–∞)
  const wave = Math.sin(animTick * 0.1) * 3;
  ctx.fillStyle = C.yellow;
  ctx.beginPath();
  ctx.moveTo(sx + 8, GROUND_Y - 118);
  ctx.lineTo(sx + 48 + wave, GROUND_Y - 108);
  ctx.lineTo(sx + 48, GROUND_Y - 92);
  ctx.lineTo(sx + 8, GROUND_Y - 88);
  ctx.fill();

  // –ø–ª–∞–Ω–µ—Ç–∞ –Ω–∞ —Ñ–ª–∞–≥–µ
  ctx.fillStyle = C.purple;
  ctx.beginPath();
  ctx.arc(sx + 28, GROUND_Y - 103, 10, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = C.yellow;
  ctx.beginPath();
  ctx.ellipse(sx + 28, GROUND_Y - 103, 15, 4, -0.3, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = C.purple;
  ctx.beginPath();
  ctx.arc(sx + 28, GROUND_Y - 103, 10, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = C.yellow;
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.ellipse(sx + 28, GROUND_Y - 103, 14, 4, -0.3, 0, Math.PI * 2);
  ctx.stroke();
}

// –û—Ç–µ–ª—å
function drawHotel(camX) {
  const sx = HOTEL_X - camX;
  if (sx > W + 20) return;

  const hw = 160, hh = 200;
  const hx = sx, hy = GROUND_Y - hh;

  // –æ—Å–Ω–æ–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ
  px(hx, hy, hw, hh, C.brownD);
  px(hx + 4, hy + 4, hw - 8, hh - 4, '#8B6040');

  // —ç—Ç–∞–∂–∏ ‚Äî –æ–∫–Ω–∞
  for (let floor = 0; floor < 4; floor++) {
    for (let win = 0; win < 3; win++) {
      const wx = hx + 14 + win * 44;
      const wy = hy + 20 + floor * 44;
      px(wx, wy, 24, 30, C.yellowD);
      px(wx + 2, wy + 2, 20, 26, C.blue);
      // —Ä–∞–º–∞
      px(wx + 10, wy, 4, 30, '#7A5030');
      px(wx, wy + 13, 24, 4, '#7A5030');
      // —Å–≤–µ—Ç –≤ –æ–∫–Ω–µ (–∞–Ω–∏–º–∞—Ü–∏—è)
      if (Math.sin(animTick * 0.05 + floor + win) > 0) {
        ctx.fillStyle = 'rgba(255, 240, 150, 0.4)';
        ctx.fillRect(wx + 2, wy + 2, 20, 26);
      }
    }
  }

  // –∫—Ä—ã—à–∞
  px(hx - 4, hy - 12, hw + 8, 16, C.purpleL);
  px(hx - 4, hy - 16, hw + 8, 8, C.purple);

  // –≤—ã–≤–µ—Å–∫–∞ HOTEL
  px(hx + 10, hy + 10, hw - 20, 20, C.purple);
  ctx.fillStyle = C.yellow;
  ctx.font = '8px "Press Start 2P"';
  ctx.textAlign = 'center';
  ctx.fillText('HOTEL', hx + hw / 2, hy + 24);

  // –≤—Ö–æ–¥
  const dw = 32, dh = 48;
  const dx = hx + hw / 2 - dw / 2, dy = GROUND_Y - dh;
  px(dx, dy, dw, dh, C.brownD);
  px(dx + 2, dy + 2, dw - 4, dh - 2, C.yellowD);
  ctx.strokeStyle = C.brownD;
  ctx.lineWidth = 2;
  ctx.strokeRect(dx + 2, dy + 2, dw - 4, dh - 2);

  // —Å—Ç—É–ø–µ–Ω—å–∫–∏
  px(hx + hw / 2 - 24, GROUND_Y - 6, 48, 6, C.grey);
  px(hx + hw / 2 - 20, GROUND_Y - 10, 40, 6, '#B0B0B0');
}

// –ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫ ‚Äî –ø–∏–∫—Å–µ–ª—å-–∞—Ä—Ç –∏–∑ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
function drawPlayer(x, y, frame, onGround) {
  const px_ = (dx, dy, w, h, c) => px(x + dx, y + dy, w, h, c);

  // —Ç–µ–Ω—å
  ctx.fillStyle = 'rgba(0,0,0,0.15)';
  ctx.beginPath();
  ctx.ellipse(x + 10, y + 48, 12, 4, 0, 0, Math.PI * 2);
  ctx.fill();

  // –ì–û–õ–û–í–ê
  px_(4, 0, 16, 14, C.skin);      // –ª–∏—Ü–æ
  px_(4, 0, 16, 4, C.brown);      // –≤–æ–ª–æ—Å—ã
  px_(2, 1, 4, 6, C.brown);       // –≤–æ–ª–æ—Å—ã —Å–±–æ–∫—É
  px_(8, 6, 3, 3, C.black);       // –ª–µ–≤—ã–π –≥–ª–∞–∑
  px_(13, 6, 3, 3, C.black);      // –ø—Ä–∞–≤—ã–π –≥–ª–∞–∑
  px_(10, 11, 6, 2, C.brownD);    // —Ä–æ—Ç

  // –ö–£–†–¢–ö–ê (—Ç–µ–ª–æ) ‚Äî –∂—ë–ª—Ç–∞—è
  px_(2, 14, 20, 18, C.yellow);
  px_(2, 14, 8, 18, C.yellowD);   // –ª–∞—Ü–∫–∞–Ω
  px_(14, 14, 8, 18, C.yellowD);  // –ª–∞—Ü–∫–∞–Ω
  px_(8, 14, 8, 18, C.white);     // —Ä—É–±–∞—à–∫–∞

  // –†–£–ö–ò
  if (frame === 0) {
    px_(-2, 16, 6, 12, C.yellow); // –ª–µ–≤–∞—è —Ä—É–∫–∞ –≤–Ω–∏–∑
    px_(20, 14, 6, 12, C.yellow); // –ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ –≤–Ω–∏–∑
  } else {
    px_(-2, 14, 6, 14, C.yellow); // –ª–µ–≤–∞—è —Ä—É–∫–∞ –≤–ø–µ—Ä—ë–¥
    px_(20, 16, 6, 14, C.yellow); // –ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ –Ω–∞–∑–∞–¥
  }

  // –®–¢–ê–ù–´ (–∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ)
  px_(2, 32, 20, 16, C.brownD);

  // –ù–û–ì–ò (–∞–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞)
  if (!onGround) {
    // –ø—Ä—ã–∂–æ–∫
    px_(2, 48, 8, 6, C.brown);
    px_(14, 46, 8, 6, C.brown);
  } else if (frame === 0) {
    px_(2, 48, 8, 10, C.brown);    // –ª–µ–≤–∞—è –Ω–æ–≥–∞
    px_(14, 44, 8, 10, C.brown);   // –ø—Ä–∞–≤–∞—è –Ω–æ–≥–∞ –≤–ø–µ—Ä—ë–¥
    px_(2, 56, 10, 4, C.brownD);   // –æ–±—É–≤—å –ª–µ–≤–æ
    px_(12, 52, 10, 4, C.brownD);  // –æ–±—É–≤—å –ø—Ä–∞–≤–æ
  } else {
    px_(2, 44, 8, 10, C.brown);    // –ª–µ–≤–∞—è –Ω–æ–≥–∞ –Ω–∞–∑–∞–¥
    px_(14, 48, 8, 10, C.brown);   // –ø—Ä–∞–≤–∞—è –Ω–æ–≥–∞
    px_(0, 52, 10, 4, C.brownD);   // –æ–±—É–≤—å –ª–µ–≤–æ
    px_(14, 56, 10, 4, C.brownD);  // –æ–±—É–≤—å –ø—Ä–∞–≤–æ
  }

  // –ß–ï–ú–û–î–ê–ù
  const cx_ = frame === 0 ? -14 : -12;
  px_(cx_, 26, 14, 18, C.purple);
  px_(cx_ + 2, 26, 10, 18, C.purpleL);
  px_(cx_ + 4, 23, 6, 4, C.purpleL);  // —Ä—É—á–∫–∞
  px_(cx_ + 6, 32, 2, 6, C.yellow);   // –∑–∞–º–æ–∫
  // –ø–æ–ª–æ—Å–∞
  px_(cx_ + 2, 33, 10, 2, C.yellowD);

}

// –ë–∞—Å—Å–µ–π–Ω
function drawPool(camX) {
  const sx = Math.round(POOL_X - camX);
  if (sx > W + 160 || sx < -160) return;

  const pw = 120, ph = 36;
  const px_ = sx, py = GROUND_Y - ph;

  // –±–æ—Ä—Ç–∏–∫
  px(px_ - 6, py - 8, pw + 12, 10, C.grey);
  px(px_ - 4, py - 6, pw + 8, 8, '#C8C8C8');

  // –≤–æ–¥–∞ (–∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
  const wave1 = Math.sin(animTick * 0.08) * 2;
  const wave2 = Math.sin(animTick * 0.06 + 1) * 2;
  px(px_, py, pw, ph, '#1A6AAA');
  // –±–ª–∏–∫–∏ –≤–æ–¥—ã
  ctx.fillStyle = '#2A8ACA';
  ctx.fillRect(px_ + 8,  py + 6 + wave1, 30, 4);
  ctx.fillRect(px_ + 60, py + 14 + wave2, 40, 4);
  ctx.fillRect(px_ + 20, py + 22 + wave1, 20, 3);
  // –±–ª–∏–∫ —Å–≤–µ—Ä—Ö—É
  ctx.fillStyle = 'rgba(255,255,255,0.25)';
  ctx.fillRect(px_, py, pw, 8);

  // –ª–µ—Å–µ–Ω–∫–∞
  px(px_ + pw - 14, py - 8, 6, ph + 8, '#A0A0A0');
  px(px_ + pw - 10, py + 6,  4, 4, '#C8C8C8');
  px(px_ + pw - 10, py + 16, 4, 4, '#C8C8C8');
  px(px_ + pw - 10, py + 26, 4, 4, '#C8C8C8');
}

// –ë—Ä—ã–∑–≥–∏ –ø—Ä–∏ –ø—Ä—ã–∂–∫–µ –≤ –±–∞—Å—Å–µ–π–Ω
function drawSplash(camX) {
  const cx = Math.round(SPLASH_X - camX);
  const py = GROUND_Y - 24;

  const t = splashTick;
  const fade = Math.max(0, 1 - t / 60);

  // –∫—Ä—É–≥–∏ —Ä–∞—Å—Ö–æ–¥—è—â–µ–π—Å—è –≤–æ–ª–Ω—ã
  for (let i = 1; i <= 3; i++) {
    const r = t * 1.2 * i * 0.4 + 8;
    ctx.strokeStyle = `rgba(100,200,255,${fade * 0.6 / i})`;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.ellipse(cx, py + 10, r, r * 0.35, 0, 0, Math.PI * 2);
    ctx.stroke();
  }

  // –∫–∞–ø–ª–∏ –≤–≤–µ—Ä—Ö
  const drops = [
    { dx: -30, dy: -60, delay: 0 },
    { dx: -18, dy: -80, delay: 2 },
    { dx:  0,  dy: -90, delay: 0 },
    { dx:  18, dy: -78, delay: 3 },
    { dx:  32, dy: -62, delay: 1 },
    { dx: -8,  dy: -70, delay: 4 },
    { dx:  10, dy: -85, delay: 2 },
  ];

  for (const d of drops) {
    const dt = Math.max(0, t - d.delay);
    if (dt <= 0) continue;
    const dropT = Math.min(dt / 25, 1);
    const dropX = cx + d.dx * dropT;
    const dropY = py + d.dy * dropT + 0.5 * 0.8 * dt * dt * 0.3; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
    const alpha = Math.max(0, 1 - dt / 35) * fade;
    ctx.fillStyle = `rgba(150,220,255,${alpha})`;
    ctx.beginPath();
    ctx.ellipse(dropX, dropY, 4, 6, 0, 0, Math.PI * 2);
    ctx.fill();
  }

  // –≥–µ—Ä–æ–π –≤ –≤–æ–¥–µ (—Ç–æ—Ä—á–∏—Ç —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ–≤–∞)
  if (t > 8) {
    const heroX = Math.round(player.x - camX);
    const submerge = Math.min(t / 15, 1);
    // —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ–≤–∞ –≤–∏–¥–Ω–∞
    px(heroX + 4, py - 14 + Math.round(submerge * 10), 16, 14, C.skin);
    px(heroX + 4, py - 14 + Math.round(submerge * 10), 16, 4, C.brown);
    // –æ—á–∫–∏/–∫–∞–ø–ª–∏ –≤–æ–¥—ã –Ω–∞ –≥–æ–ª–æ–≤–µ
    ctx.fillStyle = 'rgba(150,220,255,0.7)';
    ctx.fillRect(heroX + 4, py - 14 + Math.round(submerge * 10), 16, 3);
  }
}

// –û–±–ª–∞–∫–∞
function drawClouds(camX) {
  const clouds = [
    { x: 100, y: 60, s: 1 },
    { x: 300, y: 40, s: 0.8 },
    { x: 600, y: 70, s: 1.1 },
    { x: 900, y: 50, s: 0.9 },
    { x: 1200, y: 65, s: 1 },
    { x: 1500, y: 45, s: 0.85 },
    { x: 1800, y: 75, s: 1.1 },
    { x: 2100, y: 55, s: 0.9 },
  ];

  for (const cl of clouds) {
    const sx = (cl.x - camX * 0.2 + WORLD_WIDTH * 2) % (WORLD_WIDTH + W) - 100;
    const s = cl.s * 40;

    ctx.fillStyle = 'rgba(255,255,255,0.85)';
    ctx.beginPath();
    ctx.arc(sx, cl.y, s, 0, Math.PI * 2);
    ctx.arc(sx + s, cl.y - s * 0.3, s * 0.8, 0, Math.PI * 2);
    ctx.arc(sx - s, cl.y - s * 0.2, s * 0.7, 0, Math.PI * 2);
    ctx.fill();
  }
}

// –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç ‚Äî Press Start 2P
function drawPixelText(text, x, y, size, color, align = 'center') {
  ctx.font = `${size}px "Press Start 2P"`;
  ctx.textAlign = align;
  // —Ç–µ–Ω—å (—Å–º–µ—â–µ–Ω–∏–µ = 2px)
  ctx.fillStyle = C.black;
  ctx.fillText(text, x + 2, y + 2);
  ctx.fillStyle = color;
  ctx.fillText(text, x, y);
}

// ‚îÄ‚îÄ‚îÄ –°—Ç–∞—Ä—Ç-—ç–∫—Ä–∞–Ω ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawStartScreen() {
  // –Ω–µ–±–æ ‚Äî –≥—Ä–∞–¥–∏–µ–Ω—Ç
  const skyGrad = ctx.createLinearGradient(0, 0, 0, GROUND_Y);
  skyGrad.addColorStop(0, '#FFCC00');
  skyGrad.addColorStop(1, '#FFE880');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, W, H);

  drawMountains(0);
  drawGround(0);

  // –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
  ctx.fillStyle = 'rgba(0,0,0,0.15)';
  ctx.fillRect(0, 0, W, H);

  // –∑–∞–≥–æ–ª–æ–≤–æ–∫ ‚Äî —Ä–∞–º–∫–∞
  px(160, 80, 480, 120, C.purple);
  px(164, 84, 472, 112, C.purpleL);

  drawPixelText('–≠–ü–ò–ß–ï–°–ö–û–ï', W / 2, 132, 28, C.yellow);
  drawPixelText('–ü–†–ò–ö–õ–Æ–ß–ï–ù–ò–ï', W / 2, 172, 22, C.yellow);

  // –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
  drawPixelText('–î–æ—Ä–æ–≥–∞ –¥–æ –æ—Ç–µ–ª—è', W / 2, 218, 14, C.white);

  // –∫–Ω–æ–ø–∫–∞ –ò–ì–†–ê–¢–¨
  const bx = 270, by = 242, bw = 260, bh = 52;
  px(bx, by, bw, bh, C.black);
  px(bx + 3, by + 3, bw - 6, bh - 6, C.purple);
  // –±–ª–∏–∫
  px(bx + 3, by + 3, bw - 6, 6, C.purpleL);
  // –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Ä–∞–º–∫–∞
  ctx.setLineDash([6, 4]);
  ctx.strokeStyle = C.yellow;
  ctx.lineWidth = 2;
  ctx.strokeRect(bx + 6, by + 6, bw - 12, bh - 12);
  ctx.setLineDash([]);

  drawPixelText('–ò–ì–†–ê–¢–¨', W / 2, by + 32, 20, C.yellow);

  // –ø–æ–¥—Å–∫–∞–∑–∫–∞
  drawPixelText('–ü–†–û–ë–ï–õ / –¢–ê–ü = –ø—Ä—ã–∂–æ–∫', W / 2, 332, 10, C.white);

  // –º–∞–ª–µ–Ω—å–∫–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞ –ø—Ä–µ–≤—å—é
  drawPlayer(340, 360, Math.floor(animTick / 8) % 2, true);

  // –º–∞–ª–µ–Ω—å–∫–∏–π –æ—Ç–µ–ª—å
  ctx.save();
  ctx.scale(0.6, 0.6);
  drawHotel(-(W * 0.6 - 60));
  ctx.restore();
}

// ‚îÄ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawGameScreen() {
  // –Ω–µ–±–æ
  const skyGrad = ctx.createLinearGradient(0, 0, 0, GROUND_Y);
  skyGrad.addColorStop(0, '#FFD700');
  skyGrad.addColorStop(1, '#FFE880');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, W, H);

  drawClouds(camera);
  drawMountains(camera);
  drawGround(camera);

  // –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  for (const p of platforms) {
    drawPlatform(p, camera);
  }

  // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  for (const o of obstacles) {
    drawObstacle(o, camera);
  }

  // —Ñ–ª–∞–≥
  drawFlag(camera);

  // –æ—Ç–µ–ª—å
  drawHotel(camera);

  // –±–∞—Å—Å–µ–π–Ω (—Ç–æ–ª—å–∫–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ play)
  if (state === 'play') drawPool(camera);

  // –ø–µ—Ä—Å–æ–Ω–∞–∂ (—Ç–æ–ª—å–∫–æ –≤ play, –≤ jump/splash —Ä–∏—Å—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ gameLoop)
  if (state === 'play') drawPlayer(player.x - camera, player.y, player.frame, player.onGround);

  // –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
  const progress = Math.min(player.x / WIN_X, 1);
  px(20, 20, 200, 12, 'rgba(0,0,0,0.4)');
  px(21, 21, Math.floor(198 * progress), 10, C.purple);
  // –∏–∫–æ–Ω–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –∏ —Ñ–∏–Ω–∏—à–∞
  ctx.fillStyle = C.white;
  ctx.font = '10px "Press Start 2P"';
  ctx.textAlign = 'left';
  ctx.fillText('üèÅ', 215, 31);
  ctx.fillText(`${Math.floor(progress * 100)}%`, 20, 45);
}

// ‚îÄ‚îÄ‚îÄ –°–∞–ª—é—Ç—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fireworks = [
  { x: 130, y: 90,  colors: ['#FFD700','#FF6090','#FFFFFF'], period: 70,  offset: 0  },
  { x: 670, y: 80,  colors: ['#A040FF','#FFD700','#60FFFF'], period: 90,  offset: 30 },
  { x: 260, y: 55,  colors: ['#FF4040','#FFD700','#FFFFFF'], period: 80,  offset: 15 },
  { x: 540, y: 100, colors: ['#40FF80','#FF80FF','#FFD700'], period: 100, offset: 50 },
  { x: 400, y: 45,  colors: ['#FFD700','#FF9030','#FFFFFF'], period: 60,  offset: 5  },
];

function drawFireworks() {
  for (const fw of fireworks) {
    const t = (animTick + fw.offset) % fw.period;
    const phase = t / fw.period; // 0..1

    // —Ç—Ä–µ–π–ª —Ä–∞–∫–µ—Ç—ã (–ø–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî –ª–µ—Ç–∏—Ç –≤–≤–µ—Ä—Ö)
    if (phase < 0.35) {
      const rProgress = phase / 0.35;
      const ry = fw.y + 120 * (1 - rProgress);
      // —Ö–≤–æ—Å—Ç
      for (let i = 0; i < 5; i++) {
        const alpha = (1 - i / 5) * 0.8 * rProgress;
        ctx.fillStyle = `rgba(255,220,80,${alpha})`;
        ctx.fillRect(fw.x - 1, ry + i * 5, 2, 4);
      }
      // –∏—Å–∫—Ä–∞
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(fw.x - 2, ry - 3, 4, 4);
    }

    // –≤–∑—Ä—ã–≤ (–≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞)
    if (phase >= 0.35) {
      const eProgress = (phase - 0.35) / 0.65; // 0..1 –≤–Ω—É—Ç—Ä–∏ –≤–∑—Ä—ã–≤–∞
      const maxR = 55;
      const r = eProgress * maxR;
      const alpha = Math.max(0, 1 - eProgress * 1.4);

      const rays = 12;
      for (let i = 0; i < rays; i++) {
        const angle = (i / rays) * Math.PI * 2;
        const color = fw.colors[i % fw.colors.length];
        const ex = fw.x + Math.cos(angle) * r;
        const ey = fw.y + Math.sin(angle) * r + eProgress * eProgress * 20; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
        // —Ä–∞–∑–º–µ—Ä –∏—Å–∫—Ä—ã —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
        const sparkSize = Math.max(1, 4 * (1 - eProgress));

        ctx.fillStyle = color.replace(')', `,${alpha})`).replace('rgb', 'rgba').replace('#', '');
        // —Ä—É—á–Ω–æ–π hex ‚Üí rgba
        const hexToRgba = (hex, a) => {
          const r2 = parseInt(hex.slice(1,3),16);
          const g2 = parseInt(hex.slice(3,5),16);
          const b2 = parseInt(hex.slice(5,7),16);
          return `rgba(${r2},${g2},${b2},${a})`;
        };
        ctx.fillStyle = hexToRgba(color, alpha);
        ctx.beginPath();
        ctx.arc(ex, ey, sparkSize, 0, Math.PI * 2);
        ctx.fill();

        // –≤—Ç–æ—Ä–∏—á–Ω—ã–µ –∏—Å–∫—Ä—ã (—á—É—Ç—å –æ—Ç—Å—Ç–∞—é—Ç)
        if (eProgress > 0.15) {
          const r2 = (eProgress - 0.1) * maxR * 0.6;
          const ex2 = fw.x + Math.cos(angle + Math.PI / rays) * r2;
          const ey2 = fw.y + Math.sin(angle + Math.PI / rays) * r2 + (eProgress - 0.1) ** 2 * 20;
          ctx.fillStyle = hexToRgba(fw.colors[(i + 1) % fw.colors.length], alpha * 0.7);
          ctx.beginPath();
          ctx.arc(ex2, ey2, sparkSize * 0.7, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // —è—Ä–∫–∞—è –≤—Å–ø—ã—à–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ
      if (eProgress < 0.25) {
        const flashAlpha = (1 - eProgress / 0.25) * 0.9;
        ctx.fillStyle = `rgba(255,255,255,${flashAlpha})`;
        ctx.beginPath();
        ctx.arc(fw.x, fw.y, 8 * (1 - eProgress / 0.25), 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }
}

// ‚îÄ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawWinScreen() {
  // ‚îÄ‚îÄ –§–û–ù: –Ω–æ—á–Ω–æ–µ –Ω–µ–±–æ ‚îÄ‚îÄ
  const bg = ctx.createLinearGradient(0, 0, 0, H);
  bg.addColorStop(0, '#0D0628');
  bg.addColorStop(0.6, '#1E0A4A');
  bg.addColorStop(1, '#2A1060');
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);

  // –∑–≤—ë–∑–¥—ã (–º–µ–ª–∫–∏–µ, –º–µ—Ä—Ü–∞—é—Ç)
  const starData = [
    [40,25],[100,15],[180,35],[260,12],[340,28],[420,8],[500,22],[580,38],[660,14],[740,30],[790,20],
    [70,70],[155,55],[235,80],[315,48],[395,72],[475,60],[555,42],[635,68],[715,52],[775,78],
    [30,110],[120,95],[210,120],[300,100],[390,115],[480,90],[570,108],[650,92],[730,118],
  ];
  for (const [sx, sy] of starData) {
    const s = Math.sin(animTick * 0.04 + sx * 0.3) * 0.6 + 1;
    const alpha = Math.sin(animTick * 0.06 + sy * 0.5) * 0.3 + 0.7;
    ctx.fillStyle = `rgba(255,240,180,${alpha})`;
    ctx.beginPath();
    ctx.arc(sx, sy, s, 0, Math.PI * 2);
    ctx.fill();
  }

  // ‚îÄ‚îÄ –°–ê–õ–Æ–¢–´ ‚îÄ‚îÄ
  drawFireworks();

  // ‚îÄ‚îÄ –ó–ï–ú–õ–Ø –≤–Ω–∏–∑—É (—Å—Ü–µ–Ω–∞) ‚îÄ‚îÄ
  const groundY = H - 90;
  px(0, groundY, W, H - groundY, C.ground);
  px(0, groundY, W, 10, C.grass);
  // —Ç—Ä–∞–≤–∏–Ω–∫–∏
  for (let gx = 0; gx < W; gx += 20) {
    ctx.fillStyle = '#5A7E2A';
    ctx.fillRect(gx + 3,  groundY - 7, 2, 7);
    ctx.fillRect(gx + 10, groundY - 5, 2, 5);
    ctx.fillRect(gx + 15, groundY - 8, 2, 8);
  }

  // ‚îÄ‚îÄ –û–¢–ï–õ–¨ (–ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å) ‚îÄ‚îÄ
  const hotelX = W - 210;
  const hotelY = groundY - 180;
  const hw = 150, hh = 180;
  px(hotelX, hotelY, hw, hh, C.brownD);
  px(hotelX + 4, hotelY + 4, hw - 8, hh - 4, '#8B6040');
  // –æ–∫–Ω–∞ —Å –æ–≥–Ω—è–º–∏
  for (let fl = 0; fl < 3; fl++) {
    for (let wn = 0; wn < 3; wn++) {
      const wx = hotelX + 12 + wn * 42;
      const wy = hotelY + 28 + fl * 46;
      px(wx, wy, 22, 28, C.yellowD);
      px(wx + 2, wy + 2, 18, 24, C.blue);
      px(wx + 9, wy, 4, 28, '#7A5030');
      px(wx, wy + 12, 22, 4, '#7A5030');
      if (Math.sin(animTick * 0.07 + fl * 1.3 + wn * 2.1) > 0) {
        ctx.fillStyle = 'rgba(255,240,120,0.5)';
        ctx.fillRect(wx + 2, wy + 2, 18, 24);
      }
    }
  }
  px(hotelX - 4, hotelY - 14, hw + 8, 16, C.purpleL);
  px(hotelX - 4, hotelY - 18, hw + 8, 8, C.purple);
  px(hotelX + 8, hotelY + 8, hw - 16, 20, C.purple);
  ctx.fillStyle = C.yellow;
  ctx.font = '8px "Press Start 2P"';
  ctx.textAlign = 'center';
  ctx.fillText('HOTEL', hotelX + hw / 2, hotelY + 22);
  // –≤—Ö–æ–¥
  const dw = 30, dh = 44;
  px(hotelX + hw/2 - dw/2, groundY - dh, dw, dh, C.brownD);
  px(hotelX + hw/2 - dw/2 + 2, groundY - dh + 2, dw - 4, dh - 2, C.yellowD);
  // —Å—Ç—É–ø–µ–Ω—å–∫–∏
  px(hotelX + hw/2 - 22, groundY - 6, 44, 6, C.grey);
  px(hotelX + hw/2 - 18, groundY - 10, 36, 6, '#B8B8B8');

  // ‚îÄ‚îÄ –§–õ–ê–ì (–ª–µ–≤–µ–µ –æ—Ç–µ–ª—è) ‚îÄ‚îÄ
  const flagX = hotelX - 70;
  px(flagX + 4, groundY - 110, 4, 110, C.brownD);
  const wave = Math.sin(animTick * 0.12) * 3;
  ctx.fillStyle = C.yellow;
  ctx.beginPath();
  ctx.moveTo(flagX + 8, groundY - 108);
  ctx.lineTo(flagX + 46 + wave, groundY - 96);
  ctx.lineTo(flagX + 44, groundY - 80);
  ctx.lineTo(flagX + 8, groundY - 78);
  ctx.fill();
  ctx.fillStyle = C.purple;
  ctx.beginPath();
  ctx.arc(flagX + 27, groundY - 94, 9, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = C.yellow;
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.ellipse(flagX + 27, groundY - 94, 13, 3.5, -0.3, 0, Math.PI * 2);
  ctx.stroke();

  // ‚îÄ‚îÄ –ü–ï–†–°–û–ù–ê–ñ (—É –æ—Ç–µ–ª—è, —Ä–∞–¥—É–µ—Ç—Å—è) ‚îÄ‚îÄ
  const charX = hotelX - 56;
  const charBounce = Math.abs(Math.sin(animTick * 0.1)) * 5;
  drawPlayer(charX, groundY - 48 - charBounce, Math.floor(animTick / 8) % 2, true);

  // ‚îÄ‚îÄ –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨ ‚îÄ‚îÄ
  // —Ç–µ–Ω—å –ø–∞–Ω–µ–ª–∏
  ctx.fillStyle = 'rgba(0,0,0,0.35)';
  ctx.fillRect(88, 148, 624, 238);
  // —Ä–∞–º–∫–∞ –≤–Ω–µ—à–Ω—è—è
  px(80, 142, 624, 238, C.black);
  // —Ñ–æ–Ω –ø–∞–Ω–µ–ª–∏
  const panelGrad = ctx.createLinearGradient(80, 142, 80, 380);
  panelGrad.addColorStop(0, '#4A1880');
  panelGrad.addColorStop(1, '#2A0E58');
  ctx.fillStyle = panelGrad;
  ctx.fillRect(84, 146, 616, 230);
  // –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∫–∞-–±–ª–∏–∫
  px(84, 146, 616, 8, '#7A3AAA');
  // –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Ä–∞–º–∫–∞
  ctx.setLineDash([10, 6]);
  ctx.strokeStyle = C.yellow;
  ctx.lineWidth = 2;
  ctx.strokeRect(90, 152, 604, 218);
  ctx.setLineDash([]);

  // ‚îÄ‚îÄ –¢–ï–ö–°–¢ –ü–û–ë–ï–î–ò–õ–ò ‚îÄ‚îÄ
  drawPixelText('–í–´ –ü–û–ë–ï–î–ò–õ–ò!', W / 2, 192, 26, C.yellow);

  // —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
  px(160, 200, 480, 3, C.purpleL);

  // ‚îÄ‚îÄ –ü–†–û–ú–û–ö–û–î ‚îÄ‚îÄ
  drawPixelText('–í–ê–® –ü–†–û–ú–û–ö–û–î:', W / 2, 232, 11, '#D0A0FF');

  // –±–ª–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞
  px(220, 242, 360, 56, '#0A0020');
  px(222, 244, 356, 52, '#120830');
  ctx.setLineDash([10, 5]);
  ctx.strokeStyle = C.yellow;
  ctx.lineWidth = 2.5;
  ctx.strokeRect(226, 248, 348, 44);
  ctx.setLineDash([]);

  // –º–µ—Ä—Ü–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
  const promoGlow = Math.sin(animTick * 0.08) * 0.15 + 0.85;
  ctx.fillStyle = `rgba(255,215,0,${promoGlow})`;
  ctx.font = '28px "Press Start 2P"';
  ctx.textAlign = 'center';
  // —Ç–µ–Ω—å
  ctx.fillStyle = `rgba(80,0,120,0.8)`;
  ctx.fillText('PIXEL20', W / 2 + 2, 282 + 2);
  ctx.fillStyle = `rgba(255,215,0,${promoGlow})`;
  ctx.fillText('PIXEL20', W / 2, 282);

  // ‚îÄ‚îÄ –ö–ù–û–ü–ö–ê –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê ‚îÄ‚îÄ
  const bx = 272, by = 308, bw = 256, bh = 48;
  const btnHover = Math.sin(animTick * 0.06) * 0.5 + 0.5;
  // —Ç–µ–Ω—å
  ctx.fillStyle = 'rgba(0,0,0,0.4)';
  ctx.fillRect(bx + 4, by + 4, bw, bh);
  // —Ä–∞–º–∫–∞
  px(bx, by, bw, bh, C.black);
  // —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ (–ø—É–ª—å—Å–∏—Ä—É–µ—Ç)
  const btnColor = `rgb(${Math.floor(100 + btnHover * 20)},${Math.floor(40 + btnHover * 10)},${Math.floor(160 + btnHover * 20)})`;
  ctx.fillStyle = btnColor;
  ctx.fillRect(bx + 2, by + 2, bw - 4, bh - 4);
  // –±–ª–∏–∫
  px(bx + 2, by + 2, bw - 4, 7, '#9A5ACA');

  drawPixelText('–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê', W / 2, by + 30, 13, C.yellow);

  // ‚îÄ‚îÄ –õ–û–ì–û–¢–ò–ü ‚îÄ‚îÄ
  drawPixelText('–Ø–Ω–¥–µ–∫—Å –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', W / 2, H - 12, 9, 'rgba(180,140,220,0.8)');
}

// ‚îÄ‚îÄ‚îÄ –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function gameLoop() {
  ctx.clearRect(0, 0, W, H);

  if (state === 'start') {
    animTick++;
    drawStartScreen();
  } else if (state === 'play') {
    updateGame();
    drawGameScreen();
  } else if (state === 'jump') {
    updateJump();
    drawGameScreen();
    drawPool(camera);
    drawPlayer(player.x - camera, player.y, player.frame, player.onGround);
  } else if (state === 'splash') {
    updateSplash();
    drawGameScreen();
    drawPool(camera);
    drawSplash(camera);
  } else if (state === 'win') {
    animTick++;
    drawWinScreen();
  }

  requestAnimationFrame(gameLoop);
}

// –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ —ç–∫—Ä–∞–Ω
function resize() {
  const scaleX = window.innerWidth / W;
  const scaleY = window.innerHeight / H;
  const scale = Math.min(scaleX, scaleY);
  canvas.style.width = Math.floor(W * scale) + 'px';
  canvas.style.height = Math.floor(H * scale) + 'px';
}
window.addEventListener('resize', resize);
resize();

gameLoop();
</script>
</body>
</html>
